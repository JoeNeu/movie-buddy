import {AfterViewInit, Component, OnDestroy, OnInit, ViewChild} from '@angular/core';
import {Subject} from "rxjs";
import {MovieService} from "../../movies/movie.service";
import {HttpHeaders} from "@angular/common/http";
import {MatTabChangeEvent} from "@angular/material/tabs";

@Component({
  selector: 'app-trending',
  templateUrl: './trending.component.html',
  styleUrls: ['./trending.component.scss']
})
export class TrendingComponent implements OnInit, AfterViewInit, OnDestroy {

  private unsubscribe$ = new Subject();
  commonHttpHeaders;
  public images;
  @ViewChild('tabGroup') tabGroup;
  private currentTab: number;

  constructor(
    private movieService: MovieService
  ) {
    this.commonHttpHeaders = new HttpHeaders()
      .set('Access-Control-Allow-Methods', ['POST', 'GET', 'DELETE', 'OPTIONS', 'PUT'])
      .set('Access-Control-Allow-Origin', '*');
    this.images = []
  }

  ngAfterViewInit() {
    this.currentTab = this.tabGroup.selectedIndex;
  }

  public tabChanged(tabChangeEvent: MatTabChangeEvent): void {
    this.currentTab = tabChangeEvent.index;
  }

  ngOnInit(): void {
    // Test Data
    const data = {"page":1,"results":[{"id":438631,"adult":false,"backdrop_path":"/eeijXm3553xvuFbkPFkDG6CLCbQ.jpg","genre_ids":[28,12,878],"original_language":"en","original_title":"Dune","poster_path":"/d5NXSklXo0qyIYkgV94XAgMIckC.jpg","title":"Dune","video":false,"vote_average":8.0,"overview":"Paul Atreides, a brilliant and gifted young man born into a great destiny beyond his understanding, must travel to the most dangerous planet in the universe to ensure the future of his family and his people. As malevolent forces explode into conflict over the planet's exclusive supply of the most precious resource in existence-a commodity capable of unlocking humanity's greatest potential-only those who can conquer their fear will survive.","release_date":"2021-09-15","vote_count":3312,"popularity":3726.282,"media_type":"movie"},{"id":796499,"adult":false,"backdrop_path":"/lxLiKYM4laorYKMxyaWrSVbLIjr.jpg","genre_ids":[28,53,35],"original_language":"en","original_title":"Army of Thieves","poster_path":"/iPTZGFmPs7HsXHYxiuxGolihjOH.jpg","title":"Army of Thieves","video":false,"vote_average":6.8,"overview":"A mysterious woman recruits bank teller Ludwig Dieter to lead a group of aspiring thieves on a top-secret heist during the early stages of the zombie apocalypse.","release_date":"2021-10-29","vote_count":377,"popularity":689.059,"media_type":"movie"},{"id":580489,"adult":false,"backdrop_path":"/lNyLSOKMMeUPr1RsL4KcRuIXwHt.jpg","genre_ids":[878,28],"original_language":"en","original_title":"Venom: Let There Be Carnage","poster_path":"/rjkmN1dniUHVYAtwuV3Tji7FsDO.jpg","vote_count":1504,"video":false,"vote_average":6.9,"title":"Venom: Let There Be Carnage","overview":"After finding a host body in investigative reporter Eddie Brock, the alien symbiote must face a new enemy, Carnage, the alter ego of serial killer Cletus Kasady.","release_date":"2021-09-30","popularity":5004.938,"media_type":"movie"},{"adult":false,"backdrop_path":"/oE6bhqqVFyIECtBzqIuvh6JdaB5.jpg","genre_ids":[878,18,12],"id":522402,"original_language":"en","original_title":"Finch","overview":"On a post-apocalyptic Earth, a robot, built to protect the life of his dying creator's beloved dog, learns about life, love, friendship, and what it means to be human.","poster_path":"/jKuDyqx7jrjiR9cDzB5pxzhJAdv.jpg","release_date":"2021-11-04","title":"Finch","video":false,"vote_average":7.3,"vote_count":4,"popularity":102.242,"media_type":"movie"},{"genre_ids":[10749,18],"original_language":"en","original_title":"After We Fell","poster_path":"/3WfvjNWr5k1Zzww81b3GWc8KQhb.jpg","video":false,"vote_average":7.4,"overview":"Just as Tessa's life begins to become unglued, nothing is what she thought it would be. Not her friends nor her family. The only person that she should be able to rely on is Hardin, who is furious when he discovers the massive secret that she's been keeping. Before Tessa makes the biggest decision of her life, everything changes because of revelations about her family.","release_date":"2021-09-01","vote_count":679,"title":"After We Fell","adult":false,"backdrop_path":"/4vCh8R4yd6ybOmbxRAPOzaXmLTV.jpg","id":744275,"popularity":823.387,"media_type":"movie"},{"release_date":"2021-10-14","title":"Halloween Kills","adult":false,"backdrop_path":"/tDYwYktjFmpj92S2Qn4T3BcRgL.jpg","genre_ids":[27,53],"original_language":"en","original_title":"Halloween Kills","poster_path":"/qmJGd5IfURq8iPQ9KF3les47vFS.jpg","vote_count":1051,"video":false,"vote_average":7.1,"id":610253,"overview":"Minutes after Laurie Strode, her daughter Karen and granddaughter Allyson left masked monster Michael Myers caged and burning in Laurie's basement, Laurie is rushed to the hospital with life-threatening injuries, believing she finally killed her lifelong tormentor. But when Michael manages to free himself from Laurie's trap, his ritual bloodbath resumes. As Laurie fights her pain and prepares to defend herself against him, she inspires all of Haddonfield to rise up against their unstoppable monster. The Strode women join a group of other survivors of Michael's first rampage who decide to take matters into their own hands, forming a vigilante mob that sets out to hunt Michael down, once and for all.","popularity":1447.372,"media_type":"movie"},{"adult":false,"backdrop_path":"/3G6wET9eLvYn3aoIj8NfQFhpYEB.jpg","genre_ids":[28,12,878],"id":524434,"original_language":"en","original_title":"Eternals","overview":"The Eternals are a team of ancient aliens who have been living on Earth in secret for thousands of years. When an unexpected tragedy forces them out of the shadows, they are forced to reunite against mankind’s most ancient enemy, the Deviants.","poster_path":"/6AdXwFTRTAzggD2QUTt5B7JFGKL.jpg","release_date":"2021-11-03","title":"Eternals","video":false,"vote_average":7.4,"vote_count":152,"popularity":1447.407,"media_type":"movie"},{"adult":false,"backdrop_path":"/d0mpUFKzoPwF1KsdjHpkkaYSvKm.jpg","genre_ids":[37],"id":618162,"original_language":"en","original_title":"The Harder They Fall","overview":"Gunning for revenge, outlaw Nat Love saddles up with his gang to take down enemy Rufus Buck, a ruthless crime boss who just got sprung from prison.","poster_path":"/su9WzL7lwUZPhjH6eZByAYFx2US.jpg","release_date":"2021-10-22","title":"The Harder They Fall","video":false,"vote_average":6.3,"vote_count":57,"popularity":49.132,"media_type":"movie"},{"adult":false,"backdrop_path":"/8Y43POKjjKDGI9MH89NW0NAzzp8.jpg","genre_ids":[35,28,12,878],"original_language":"en","original_title":"Free Guy","poster_path":"/xmbU4JTUm8rsdtn7Y3Fcm30GpeT.jpg","video":false,"vote_average":7.8,"vote_count":3359,"overview":"A bank teller called Guy realizes he is a background character in an open world video game called Free City that will soon go offline.","release_date":"2021-08-11","title":"Free Guy","id":550988,"popularity":1962.294,"media_type":"movie"},{"id":631843,"adult":false,"backdrop_path":"/iTgM25ftE7YtFgZwUZupVp8A61S.jpg","genre_ids":[53,9648,27],"vote_count":1539,"original_language":"en","original_title":"Old","poster_path":"/vclShucpUmPhdAOmKgf3B3Z4POD.jpg","title":"Old","video":false,"vote_average":6.7,"release_date":"2021-07-21","overview":"A group of families on a tropical holiday discover that the secluded beach where they are staying is somehow causing them to age rapidly – reducing their entire lives into a single day.","popularity":452.134,"media_type":"movie"},{"original_title":"F9","poster_path":"/bOFaAXmWWXC3Rbv4u4uM9ZSzRXP.jpg","title":"F9","vote_average":7.4,"overview":"Dominic Toretto and his crew battle the most skilled assassin and high-performance driver they've ever encountered: his forsaken brother.","release_date":"2021-05-19","vote_count":4263,"adult":false,"backdrop_path":"/fWjcUTKOKsAPK4VUAzEQW4kN4K6.jpg","video":false,"genre_ids":[28,80,53],"id":385128,"original_language":"en","popularity":739.179,"media_type":"movie"},{"id":436969,"adult":false,"backdrop_path":"/jlGmlFOcfo8n5tURmhC7YVd4Iyy.jpg","genre_ids":[28,12,14],"vote_count":4631,"original_language":"en","original_title":"The Suicide Squad","poster_path":"/kb4s0ML0iVZlG6wAKbbs9NAm6X.jpg","title":"The Suicide Squad","video":false,"vote_average":7.8,"release_date":"2021-07-28","overview":"Supervillains Harley Quinn, Bloodsport, Peacemaker and a collection of nutty cons at Belle Reve prison join the super-secret, super-shady Task Force X as they are dropped off at the remote, enemy-infused island of Corto Maltese.","popularity":817.341,"media_type":"movie"},{"overview":"A young woman seeking self-improvement enlists the help of a renowned hypnotist but, after a handful of intense sessions, discovers unexpected and deadly consequences.","release_date":"2021-10-27","adult":false,"backdrop_path":"/9CyFLGfeDOrOOPouHp446T5MSNi.jpg","genre_ids":[53,18,27],"vote_count":177,"original_language":"en","id":864873,"poster_path":"/miEj4kNc4efZ5WbPJqWl1UXWrvS.jpg","title":"Hypnotic","video":false,"vote_average":6.1,"original_title":"Hypnotic","popularity":644.92,"media_type":"movie"},{"overview":"Bond has left active service and is enjoying a tranquil life in Jamaica. His peace is short-lived when his old friend Felix Leiter from the CIA turns up asking for help. The mission to rescue a kidnapped scientist turns out to be far more treacherous than expected, leading Bond onto the trail of a mysterious villain armed with dangerous new technology.","release_date":"2021-09-29","adult":false,"backdrop_path":"/u5Fp9GBy9W8fqkuGfLBuuoJf57Z.jpg","id":370172,"genre_ids":[12,28,53],"vote_count":1106,"original_language":"en","original_title":"No Time to Die","poster_path":"/iUgygt3fscRoKWCV1d0C7FbM9TP.jpg","title":"No Time to Die","video":false,"vote_average":7.4,"popularity":402.291,"media_type":"movie"},{"original_language":"en","original_title":"Venom","poster_path":"/2uNW4WbgBXL25BAbXGLnLqX71Sw.jpg","title":"Venom","video":false,"vote_average":6.8,"overview":"Investigative journalist Eddie Brock attempts a comeback following a scandal, but accidentally becomes the host of Venom, a violent, super powerful alien symbiote. Soon, he must rely on his newfound powers to protect the world from a shadowy organization looking for a symbiote of their own.","release_date":"2018-09-28","vote_count":12076,"adult":false,"backdrop_path":"/VuukZLgaCrho2Ar8Scl9HtV3yD.jpg","id":335983,"genre_ids":[878,28],"popularity":1227.108,"media_type":"movie"},{"vote_average":6.8,"overview":"A college student moonlighting as a chauffeur picks up two mysterious women for a night of party-hopping across LA. But when he uncovers their bloodthirsty intentions - and their dangerous, shadowy underworld - he must fight to stay alive.","release_date":"2021-10-20","adult":false,"backdrop_path":"/mzulkJNDNasq6KyoNm03uaJVZSL.jpg","vote_count":265,"genre_ids":[27,53,28],"video":false,"original_language":"en","original_title":"Night Teeth","poster_path":"/4niEFGAUEz3GUqwk9Y2y4aAERhE.jpg","title":"Night Teeth","id":669671,"popularity":469.613,"media_type":"movie"},{"adult":false,"backdrop_path":"/pVAWkob7vrviUJ0RIextyl5tGXF.jpg","genre_ids":[27,9648,53],"id":609972,"original_language":"en","original_title":"Paranormal Activity: Next of Kin","overview":"Margot, a documentary filmmaker, heads to a secluded Amish community in the hopes of learning about her long-lost mother and extended family. Following a string of strange occurrences and discoveries, she comes to realize this community may not be what it seems.","poster_path":"/VWLIJBn5UdSV0osmnF7JAwfWSE.jpg","release_date":"2021-10-29","title":"Paranormal Activity: Next of Kin","video":false,"vote_average":6.7,"vote_count":73,"popularity":100.684,"media_type":"movie"},{"adult":false,"backdrop_path":"/keIxh0wPr2Ymj0Btjh4gW7JJ89e.jpg","genre_ids":[28,12,878],"vote_count":5756,"original_language":"en","original_title":"Black Widow","poster_path":"/qAZ0pzat24kLdO3o8ejmbLxyOac.jpg","release_date":"2021-07-07","video":false,"vote_average":7.7,"title":"Black Widow","overview":"Natasha Romanoff, also known as Black Widow, confronts the darker parts of her ledger when a dangerous conspiracy with ties to her past arises. Pursued by a force that will stop at nothing to bring her down, Natasha must deal with her history as a spy and the broken relationships left in her wake long before she became an Avenger.","id":497698,"popularity":632.375,"media_type":"movie"},{"original_language":"en","original_title":"Apex","poster_path":"/cobRV6hAj8h7dRU4WZ3dkGaRQv2.jpg","id":763164,"title":"Apex","vote_average":0.0,"overview":"Ex-cop James Malone is serving a life sentence for a crime he didn’t commit. He is offered a chance at freedom if he can survive a deadly game of Apex, in which six hunters pay for the pleasure of hunting another human on a remote island. He accepts, and once he arrives, all hell breaks loose.","release_date":"2021-11-12","vote_count":0,"adult":false,"backdrop_path":"/oGC6etRRnMQaLAorTESurrHquB.jpg","video":false,"genre_ids":[28,53,878],"popularity":74.633,"media_type":"movie"},{"overview":"Shang-Chi must confront the past he thought he left behind when he is drawn into the web of the mysterious Ten Rings organization.","release_date":"2021-09-01","adult":false,"backdrop_path":"/nDLylQOoIazGyYuWhk21Yww5FCb.jpg","id":566525,"genre_ids":[28,12,14],"vote_count":1387,"original_language":"en","original_title":"Shang-Chi and the Legend of the Ten Rings","poster_path":"/1BIoJGKbXjdFDAqUEiA2VHqkK1Z.jpg","title":"Shang-Chi and the Legend of the Ten Rings","video":false,"vote_average":7.7,"popularity":994.424,"media_type":"movie"}],"total_pages":1000,"total_results":20000}

    // this.movieService.getTrendingMovies().subscribe(data => {
    //     this.images = data.results.map(obj => {
    //       return {path: 'https://www.themoviedb.org/t/p/w300_and_h450_bestv2' + obj.poster_path}
    //     })
    //   }
    // )
    this.images = data.results.map(obj => {
      return {path: 'https://www.themoviedb.org/t/p/w300_and_h450_bestv2' + obj.poster_path}
    })
  }

  ngOnDestroy() {
    this.unsubscribe$.next();
    this.unsubscribe$.complete();
  }
}
